#!/usr/bin/env ansible-playbook
---
#
#      Copyright (c) 2023 BlueAlly NetCraftsmen, LLC
#      All rights reserved.
#
#      Author: @joelwking
#
#      Usage: ansible-rulebook --rulebook rb.kafka.yml -i inventory.yml  -v
#             ansible-rulebook -r rb.kafka.yml -i inventory.yml -v --env-vars CLUSTER_API_KEY,CLUSTER_API_SECRET,TOPIC
- name: Kafka consumer for Meraki clients
  hosts: all

  sources:
   - netcraftsmen.kafka.consumer:
   # consumer is in the current directory for now
   # - consumer:
        host: pkc-n00kk.us-east-1.aws.confluent.cloud  # TODO
        port: 9092  # TODO
        username: "{{ CLUSTER_API_KEY }}"
        password: "{{ CLUSTER_API_SECRET }}"
        check_hostname: False
        encoding: utf-8
        topic: "{{ TOPIC }}"
        group_id: semaphore_1  # TODO
        offset: latest         # TODO

  rules:
    - name: match on anything
      condition:  event.payload is defined
      action:
        # debug:
        #  var:  event.payload

        run_playbook:
          name: pb.debug.yml